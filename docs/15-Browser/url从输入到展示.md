---
title: 从输入URL到浏览器展示
---

## 从输入 URL 到浏览器展示

## 1.查找缓存

- http 强缓存 exprise
- 浏览器缓存：浏览器会记录DNS一段时间，因此，只是第一个地方解析DNS请求；
- 操作系统缓存:如果在浏览器缓存中不包含这个记录，则会使系统调用操作系统， 获取操作系统的记录(保存最近的DNS查询缓存)；
- 路由器缓存：如果上述两个步骤均不能成功获取DNS记录，继续搜索路由器缓存；
- ISP缓存：若上述均失败，继续向ISP搜索。

### 2. DNS 解析

- DNS 域名查询

1. DNS 走缓存
2. 开启 Dns 预解析 x-dns-prefetch-control
3. dns-prefetch 强制对 域名做预解析
4. 端内：提前初始化 WebView 并且加载域名开始解析，端外：iframe

- 根据域名得到 ip 地址

### 3. 建立 TCP 链接

- TCP 三次握手

### 浏览器发起 HTTP 请求（ 总共 2s）

- 协商缓存
- 请求阻塞（同域名 并发 6 个）域名散列

### 服务器响应 HTTP 请求，返回 HTML 内容

- Service Worker
- CDN
- 避免重定向

### 浏览器解析 HTML 代码，并请求 HTML 代码中的资源

1. 构建CSS规则树：生成CSS规则树（CSS Rule Tree）

2. 构建DOM树：词法分析然后解析成DOM树（dom tree），是由dom元素及属性节点组成，树的根是document对象
    - 遇到 script 标签 用 defer 和 async，避免阻塞

3. 构建render树：Web浏览器将DOM和CSSOM结合，并构建出渲染树（render tree）
4. 布局（Layout）：计算出每个节点在屏幕中的位置
    - 重绘
    - 回流
5. 绘制（Painting）：即遍历render树，并使用UI后端层绘制每个节点。

#### 解析JS

- 创建window对象：window对象也叫全局执行环境，当页面产生时就被创建，所有的全局变量和函数都属于window的属性和方法，而DOM Tree也会映射在window的doucment对象上。当关闭网页或者关闭浏览器时，全局执行环境会被销毁。
- 加载文件：完成js引擎分析它的语法与词法是否合法，如果合法进入预编译
- 预编译：在预编译的过程中，浏览器会寻找全局变量声明，把它作为window的属性加入到window对象中，并给变量赋值为'undefined'；寻找全局函数声明，把它作为window的方法加入到window对象中，并将函数体赋值给他（匿名函数是不参与预编译的，因为它是变量）。而变量提升作为不合理的地方在ES6中已经解决了，函数提升还存在。
- 解释执行：执行到变量就赋值，如果变量没有被定义，也就没有被预编译直接赋值，在ES5非严格模式下这个变量会成为window的一个属性，也就是成为全局变量。string、int这样的值就是直接把值放在变量的存储空间里，object对象就是把指针指向变量的存储空间。函数执行，就将函数的环境推入一个环境的栈中，执行完成后再弹出，控制权交还给之前的环境。JS作用域其实就是这样的执行流机制实现的。

### 断开链接 TCP四次挥手




## 参考

- [阿里二面问了我30分钟从URL输入到渲染](https://mp.weixin.qq.com/s/0lz4vX3R7DcxuSdLJKEc8Q)
